<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 1 章 Docker</title><link rel="stylesheet" type="text/css" href="../docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><meta name="keywords" content="qmeu,kvm,xen,openvz, docker, coreos, , " /><link rel="home" href="../index.html" title="Netkiller Virtualization 手札" /><link rel="up" href="../index.html" title="Netkiller Virtualization 手札" /><link rel="prev" href="../contacts.html" title="1.5. 联系方式" /><link rel="next" href="ch01s02.html" title="1.2. Docker 图形化管理界面" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
   	    <a xmlns="" href="https://edu.51cto.com/lecturer/1703915.html">51CTO学院</a> |
	    <a xmlns="" href="https://edu.csdn.net/lecturer/6423">CSDN程序员研修院</a> |
	    <a xmlns="" href="https://github.com/netkiller">Github</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://cloud.tencent.com/developer/column/2078">腾讯云社区</a> |
	    <a xmlns="" href="https://yq.aliyun.com/u/netkiller/">阿里云栖社区</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 1 章 Docker</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../contacts.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch01s02.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td><td></td><td><a href="https://zhuanlan.zhihu.com/netkiller"><img src="/images/logo/zhihu-card-default.svg" height="25" /></a></td><td valign="middle"><a href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> ｜ <a href="https://www.zhihu.com/club/1241768772601950208">多维度架构</a></td><td></td><td></td><td></td><td></td></tr></table><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="index"></a>第 1 章 Docker</h1></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#install">1.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm108453210880">1.1.1. CentOS 8 Stream</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm108453208304">1.1.1.1. docker-compose</a></span></dt><dt><span class="section"><a href="index.html#idm108453206368">1.1.1.2. 切换镜像</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#idm108453205136">1.1.2. CentOS 7 docker-ce</a></span></dt><dt><span class="section"><a href="index.html#idm108453200880">1.1.3. CentOS 6</a></span></dt><dt><span class="section"><a href="index.html#idm108453198592">1.1.4. Ubuntu</a></span></dt><dt><span class="section"><a href="index.html#idm108453196288">1.1.5. Ubuntu docker-ce</a></span></dt><dt><span class="section"><a href="index.html#idm108453191664">1.1.6. 测试 Docker</a></span></dt><dt><span class="section"><a href="index.html#docker.reset">1.1.7. 重置 Docker</a></span></dt></dl></dd><dt><span class="section"><a href="ch01s02.html">1.2. Docker 图形化管理界面</a></span></dt><dd><dl><dt><span class="section"><a href="ch01s02.html#idm108453187840">1.2.1. Portainer</a></span></dt><dd><dl><dt><span class="section"><a href="ch01s02.html#idm108453186304">1.2.1.1. 安装</a></span></dt><dt><span class="section"><a href="ch01s02.html#idm108453181120">1.2.1.2. 配置 Portainer</a></span></dt><dt><span class="section"><a href="ch01s02.html#idm108453180864">1.2.1.3. 添加代理出错</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="docker.config.html">1.3. 配置 Docker</a></span></dt><dd><dl><dt><span class="section"><a href="docker.config.html#idm108453158384">1.3.1. 开启远程访问</a></span></dt><dt><span class="section"><a href="docker.config.html#idm108453158016">1.3.2. 镜像配置</a></span></dt><dd><dl><dt><span class="section"><a href="docker.config.html#idm108453151536">1.3.2.1. 临时选择镜像</a></span></dt><dt><span class="section"><a href="docker.config.html#idm108453149632">1.3.2.2. 切换国内镜像</a></span></dt></dl></dd><dt><span class="section"><a href="docker.config.html#idm108453145936">1.3.3. ulimit 资源</a></span></dt></dl></dd><dt><span class="section"><a href="docker.images.html">1.4. 镜像</a></span></dt><dd><dl><dt><span class="section"><a href="docker.images.html#docker.image.search">1.4.1. 搜索镜像</a></span></dt><dt><span class="section"><a href="docker.images.html#docker.image.pull">1.4.2. 获取镜像</a></span></dt><dt><span class="section"><a href="docker.images.html#docker.image.list">1.4.3. 列出本地镜像</a></span></dt><dt><span class="section"><a href="docker.images.html#docker.image.tag">1.4.4. tag</a></span></dt><dt><span class="section"><a href="docker.images.html#docker.image.save">1.4.5. 保存和载入镜像</a></span></dt><dt><span class="section"><a href="docker.images.html#docker.image.remove">1.4.6. 删除本地镜像</a></span></dt><dt><span class="section"><a href="docker.images.html#docker.image.history">1.4.7. history 镜像历史纪录</a></span></dt></dl></dd><dt><span class="section"><a href="container.html">1.5. 容器</a></span></dt><dd><dl><dt><span class="section"><a href="container.html#container.ls">1.5.1. 查看容器</a></span></dt><dt><span class="section"><a href="container.html#container.run">1.5.2. 启动与终止容器</a></span></dt><dt><span class="section"><a href="container.html#container.attach">1.5.3. 进入容器</a></span></dt><dt><span class="section"><a href="container.html#container.exec">1.5.4. 运行容器内的命令</a></span></dt><dt><span class="section"><a href="container.html#container.export">1.5.5. 导出和导入容器</a></span></dt><dd><dl><dt><span class="section"><a href="container.html#idm108453107472">1.5.5.1. Ubuntu</a></span></dt><dt><span class="section"><a href="container.html#idm108453104400">1.5.5.2. Mac 导出与导入</a></span></dt></dl></dd><dt><span class="section"><a href="container.html#container.kill">1.5.6. 停止所有容器</a></span></dt><dd><dl><dt><span class="section"><a href="container.html#idm108453098480">1.5.6.1. 信号处理</a></span></dt></dl></dd><dt><span class="section"><a href="container.html#container.rm">1.5.7. 删除容器</a></span></dt><dt><span class="section"><a href="container.html#container.log-driver">1.5.8. log-driver</a></span></dt><dt><span class="section"><a href="container.html#container.system">1.5.9. 操作系统</a></span></dt><dd><dl><dt><span class="section"><a href="container.html#container.env">1.5.9.1. 设置环境变量</a></span></dt><dt><span class="section"><a href="container.html#idm108453085920">1.5.9.2. /etc/hosts 配置</a></span></dt><dt><span class="section"><a href="container.html#sysctl">1.5.9.3. sysctl</a></span></dt><dt><span class="section"><a href="container.html#idm108453081248">1.5.9.4. ulimits</a></span></dt></dl></dd><dt><span class="section"><a href="container.html#container.top">1.5.10. 查看容器内运行的进程</a></span></dt><dt><span class="section"><a href="container.html#container.update">1.5.11. 更新容器资源配置</a></span></dt><dt><span class="section"><a href="container.html#container.wait">1.5.12. 查看容器的退出状态</a></span></dt><dt><span class="section"><a href="container.html#container.pause">1.5.13. 暂停与恢复容器</a></span></dt><dt><span class="section"><a href="container.html#container.diff">1.5.14. 对比容器的变化</a></span></dt><dt><span class="section"><a href="container.html#container.stats">1.5.15. 查看容器状态</a></span></dt><dt><span class="section"><a href="container.html#idm108453066304">1.5.16. 重启容器</a></span></dt></dl></dd><dt><span class="section"><a href="docker.volume.html">1.6. 卷管理</a></span></dt><dd><dl><dt><span class="section"><a href="docker.volume.html#idm108453064560">1.6.1. 列出卷 </a></span></dt><dt><span class="section"><a href="docker.volume.html#idm108453061664">1.6.2. 创建卷</a></span></dt><dt><span class="section"><a href="docker.volume.html#idm108453059456">1.6.3. 挂在镜像</a></span></dt><dt><span class="section"><a href="docker.volume.html#idm108453056224">1.6.4. 检查卷</a></span></dt><dt><span class="section"><a href="docker.volume.html#idm108453054624">1.6.5. 删除卷</a></span></dt><dt><span class="section"><a href="docker.volume.html#idm108453053312">1.6.6. 销毁所有未使用的卷</a></span></dt><dt><span class="section"><a href="docker.volume.html#idm108453051840">1.6.7. 在多个容器间共享卷</a></span></dt><dt><span class="section"><a href="docker.volume.html#idm108453051584">1.6.8. 容器绑定本地文件系统</a></span></dt><dt><span class="section"><a href="docker.volume.html#idm108453044576">1.6.9. 只读权限</a></span></dt></dl></dd><dt><span class="section"><a href="repository.html">1.7. 仓库</a></span></dt><dd><dl><dt><span class="section"><a href="repository.html#idm108453041408">1.7.1. Docker 官方仓库</a></span></dt><dd><dl><dt><span class="section"><a href="repository.html#idm108453040688">1.7.1.1. 登陆仓库</a></span></dt><dt><span class="section"><a href="repository.html#idm108453038880">1.7.1.2. 获取镜像</a></span></dt><dt><span class="section"><a href="repository.html#idm108453037600">1.7.1.3. 上传镜像</a></span></dt></dl></dd><dt><span class="section"><a href="repository.html#docker.registry">1.7.2. 私有仓库</a></span></dt><dd><dl><dt><span class="section"><a href="repository.html#idm108453035024">1.7.2.1. 搭建私有仓库</a></span></dt><dt><span class="section"><a href="repository.html#idm108453034768">1.7.2.2. 推送镜像到私有仓库</a></span></dt><dt><span class="section"><a href="repository.html#idm108453020688">1.7.2.3. 查询镜像</a></span></dt><dt><span class="section"><a href="repository.html#registry.config">1.7.2.4. registry 镜像高级配置</a></span></dt><dd><dl><dt><span class="section"><a href="repository.html#registry.auth">1.7.2.4.1. 私有仓库认证</a></span></dt></dl></dd><dt><span class="section"><a href="repository.html#registry.api">1.7.2.5. registry 接口</a></span></dt></dl></dd><dt><span class="section"><a href="repository.html#Harbor">1.7.3. Harbor</a></span></dt></dl></dd><dt><span class="section"><a href="docker.swarms.html">1.8. Swarms</a></span></dt><dd><dl><dt><span class="section"><a href="docker.swarms.html#idm108452999152">1.8.1. 管理 Swarms</a></span></dt><dd><dl><dt><span class="section"><a href="docker.swarms.html#idm108452997424">1.8.1.1. 查看 Swarms 版本</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452996000">1.8.1.2. 初始化 Swarms</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452994352">1.8.1.3. 显示 join-token</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452992768">1.8.1.4. 创建虚拟机</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452991008">1.8.1.5. 显示虚拟机列表</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452989696">1.8.1.6. 设置管理节点</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452986144">1.8.1.7. 环境变量</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452983920">1.8.1.8. 切换节点</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452981072">1.8.1.9. 启动/停止节点</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452979264">1.8.1.10. 离线</a></span></dt></dl></dd><dt><span class="section"><a href="docker.swarms.html#docker.stack">1.8.2. Stack</a></span></dt><dt><span class="section"><a href="docker.swarms.html#docker.service">1.8.3. 服务</a></span></dt><dd><dl><dt><span class="section"><a href="docker.swarms.html#idm108452965728">1.8.3.1. 创建 Service</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452965600">1.8.3.2. 删除 Service</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452959120">1.8.3.3. inspect</a></span></dt></dl></dd><dt><span class="section"><a href="docker.swarms.html#idm108452957888">1.8.4. Docker 网络</a></span></dt><dd><dl><dt><span class="section"><a href="docker.swarms.html#idm108452957232">1.8.4.1. 创建 overlay 网络</a></span></dt></dl></dd><dt><span class="section"><a href="docker.swarms.html#idm108452951856">1.8.5. swarm 卷管理</a></span></dt><dd><dl><dt><span class="section"><a href="docker.swarms.html#idm108452950784">1.8.5.1. Host Volumes</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452949312">1.8.5.2. Named Volumes</a></span></dt><dt><span class="section"><a href="docker.swarms.html#idm108452947936">1.8.5.3. 共享卷</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="cli.html">1.9. docker 命令</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#idm108452944800">1.9.1. docker - A self-sufficient runtime for containers</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#docker.info">1.9.1.1. 查看 docker 信息</a></span></dt><dt><span class="section"><a href="cli.html#run">1.9.1.2. run</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#idm108452938688">1.9.1.2.1. --privileged 让 root 具备真正的 root 权限</a></span></dt></dl></dd><dt><span class="section"><a href="cli.html#start">1.9.1.3. start / stop / restart</a></span></dt><dt><span class="section"><a href="cli.html#ps">1.9.1.4. ps</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#idm108452931520">1.9.1.4.1. 不截断输出，显示完整信息</a></span></dt></dl></dd><dt><span class="section"><a href="cli.html#docker.kill">1.9.1.5. kill 信号</a></span></dt><dt><span class="section"><a href="cli.html#top">1.9.1.6. top</a></span></dt><dt><span class="section"><a href="cli.html#inspect">1.9.1.7. inspect</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#idm108452922912">1.9.1.7.1. 获取容器名称</a></span></dt><dt><span class="section"><a href="cli.html#idm108452920944">1.9.1.7.2. 容器镜像名称</a></span></dt><dt><span class="section"><a href="cli.html#idm108452919472">1.9.1.7.3. 获取容器主机名 Hostname</a></span></dt><dt><span class="section"><a href="cli.html#idm108452918000">1.9.1.7.4. 查询 IP 地址</a></span></dt><dt><span class="section"><a href="cli.html#idm108452915024">1.9.1.7.5. 容器日志</a></span></dt><dt><span class="section"><a href="cli.html#idm108452913696">1.9.1.7.6. 获取 json 配置</a></span></dt><dt><span class="section"><a href="cli.html#idm108452912512">1.9.1.7.7. 函数</a></span></dt><dt><span class="section"><a href="cli.html#idm108452912256">1.9.1.7.8. 综合查询</a></span></dt></dl></dd><dt><span class="section"><a href="cli.html#images">1.9.1.8. images</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#idm108452902816">1.9.1.8.1. Getting a new image</a></span></dt></dl></dd><dt><span class="section"><a href="cli.html#logs">1.9.1.9. logs</a></span></dt><dt><span class="section"><a href="cli.html#reset">1.9.1.10. 重置 Docker </a></span></dt><dt><span class="section"><a href="cli.html#docker.cli.registry">1.9.1.11. 仓库操作</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#idm108452894624">1.9.1.11.1. 登陆</a></span></dt><dt><span class="section"><a href="cli.html#idm108452890640">1.9.1.11.2. 注销</a></span></dt></dl></dd><dt><span class="section"><a href="cli.html#docker.build">1.9.1.12. build</a></span></dt><dt><span class="section"><a href="cli.html#docker.network">1.9.1.13. 网络管理</a></span></dt><dt><span class="section"><a href="cli.html#docker.events">1.9.1.14. 事件信息</a></span></dt><dt><span class="section"><a href="cli.html#docker.cp">1.9.1.15. 从 docker 中复制文件</a></span></dt></dl></dd><dt><span class="section"><a href="cli.html#docker-compose">1.9.2. docker-compose - Define and run multi-container applications with Docker.</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#idm108452879728">1.9.2.1. 安装 docker-compose</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#idm108452878864">1.9.2.1.1. 使用 pip 安装</a></span></dt><dt><span class="section"><a href="cli.html#idm108452877472">1.9.2.1.2. OSCM 安装</a></span></dt></dl></dd><dt><span class="section"><a href="cli.html#idm108452875984">1.9.2.2. 查看版本号</a></span></dt><dt><span class="section"><a href="cli.html#idm108452874624">1.9.2.3. 快速入门</a></span></dt><dt><span class="section"><a href="cli.html#docker-compose.up">1.9.2.4. 启动</a></span></dt><dt><span class="section"><a href="cli.html#docker-compose.down">1.9.2.5. 停止</a></span></dt><dd><dl><dt><span class="section"><a href="cli.html#idm108452864672">1.9.2.5.1. 停止</a></span></dt><dt><span class="section"><a href="cli.html#idm108452862864">1.9.2.5.2. 启动</a></span></dt></dl></dd><dt><span class="section"><a href="cli.html#docker-compose.ps">1.9.2.6. 查看进程</a></span></dt><dt><span class="section"><a href="cli.html#docker-compose.logs">1.9.2.7. 查看日志</a></span></dt><dt><span class="section"><a href="cli.html#docker-compose.exec">1.9.2.8. 执行命令</a></span></dt><dt><span class="section"><a href="cli.html#docker-compose.run">1.9.2.9. 运行</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="Dockerfile.html">1.10. Dockerfile</a></span></dt><dd><dl><dt><span class="section"><a href="Dockerfile.html#idm108452853920">1.10.1. 基于 Dockerfile 创建镜像</a></span></dt><dd><dl><dt><span class="section"><a href="Dockerfile.html#idm108452852560">1.10.1.1. 创建 Dockerfile 文件</a></span></dt><dt><span class="section"><a href="Dockerfile.html#idm108452850880">1.10.1.2. 创建镜像</a></span></dt><dt><span class="section"><a href="Dockerfile.html#idm108452847760">1.10.1.3. 运行镜像</a></span></dt><dt><span class="section"><a href="Dockerfile.html#idm108452845264">1.10.1.4. 测试 Nginx</a></span></dt><dt><span class="section"><a href="Dockerfile.html#idm108452842480">1.10.1.5. 提交镜像</a></span></dt></dl></dd><dt><span class="section"><a href="Dockerfile.html#idm108452840880">1.10.2. Dockerfile 缺失的工具</a></span></dt><dd><dl><dt><span class="section"><a href="Dockerfile.html#idm108452839696">1.10.2.1. debian 镜像</a></span></dt><dt><span class="section"><a href="Dockerfile.html#idm108452836192">1.10.2.2. centos</a></span></dt></dl></dd><dt><span class="section"><a href="Dockerfile.html#idm108452834192">1.10.3. Dockerfile 语法</a></span></dt><dd><dl><dt><span class="section"><a href="Dockerfile.html#idm108452816048">1.10.3.1. COPY</a></span></dt><dt><span class="section"><a href="Dockerfile.html#idm108452812736">1.10.3.2. EXPOSE</a></span></dt><dt><span class="section"><a href="Dockerfile.html#idm108452811488">1.10.3.3. ENTRYPOINT</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="docker-compose.yml.html">1.11. docker-compose.yml 容器编排</a></span></dt><dd><dl><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.version">1.11.1. 版本号</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.image">1.11.2. 镜像</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.container_name">1.11.3. 容器名称</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.restart">1.11.4. 启动策略</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.user">1.11.5. 容器用户</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.volumes">1.11.6. 挂在卷</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.ports">1.11.7. 映射端口的标签</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.extra_hosts">1.11.8. 添加 hosts 文件</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.links">1.11.9. links</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.depends_on">1.11.10. 服务依赖</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.working_dir">1.11.11. working_dir</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.environment">1.11.12. 设置环境变量</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.tmpfs">1.11.13. 临时文件系统</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.yml.Dockerfile">1.11.14. 编译 Dockerfile</a></span></dt><dt><span class="section"><a href="docker-compose.yml.html#docker-compose.resources">1.11.15. resources 硬件资源分配</a></span></dt></dl></dd><dt><span class="section"><a href="docker.example.html">1.12. Docker Example</a></span></dt><dd><dl><dt><span class="section"><a href="docker.example.html#idm108452768496">1.12.1. registry</a></span></dt><dd><dl><dt><span class="section"><a href="docker.example.html#idm108452767520">1.12.1.1. Auth + SSL</a></span></dt></dl></dd><dt><span class="section"><a href="docker.example.html#example.java">1.12.2. Example Java - Spring boot with Docker</a></span></dt><dd><dl><dt><span class="section"><a href="docker.example.html#idm108452764160">1.12.2.1. 获取 CentOS 7 镜像</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452759552">1.12.2.2. 安装 openjdk</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452755088">1.12.2.3. Spring boot 包</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452753248">1.12.2.4. 启动 Spring boot 项目</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452753120">1.12.2.5. 基于 CentOS 7 制作 spring 镜像</a></span></dt></dl></dd><dt><span class="section"><a href="docker.example.html#example.redis">1.12.3. Redis</a></span></dt><dd><dl><dt><span class="section"><a href="docker.example.html#idm108452739328">1.12.3.1. Docker 命令</a></span></dt><dd><dl><dt><span class="section"><a href="docker.example.html#idm108452738448">1.12.3.1.1. 获取 Redis 镜像</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452736208">1.12.3.1.2. 启动一个 Redis 实例</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452733664">1.12.3.1.3. 进入 Redis </a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452732352">1.12.3.1.4. 启动一个 Redis 实例并映射 6379 端口</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452729632">1.12.3.1.5. 维护容器</a></span></dt></dl></dd><dt><span class="section"><a href="docker.example.html#idm108452727792">1.12.3.2. Docker compose</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452724064">1.12.3.3. Docker Stack</a></span></dt></dl></dd><dt><span class="section"><a href="docker.example.html#docker.nginx">1.12.4. Nginx</a></span></dt><dd><dl><dt><span class="section"><a href="docker.example.html#idm108452714320">1.12.4.1. nginx:latest</a></span></dt><dt><span class="section"><a href="docker.example.html#alpine">1.12.4.2. 安装 Docker Nginx alpine</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452702896">1.12.4.3. 安装依赖工具</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452701744">1.12.4.4. 容器内优雅重启</a></span></dt></dl></dd><dt><span class="section"><a href="docker.example.html#idm108452701488">1.12.5. MySQL</a></span></dt><dt><span class="section"><a href="docker.example.html#idm108452685280">1.12.6. MongoDB</a></span></dt></dl></dd><dt><span class="section"><a href="docker.faq.html">1.13. Docker FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="docker.faq.html#idm108452681744">1.13.1. 检查 Docker 是否可用</a></span></dt><dt><span class="section"><a href="docker.faq.html#idm108452680432">1.13.2. Bitnami</a></span></dt><dt><span class="section"><a href="docker.faq.html#idm108452678640">1.13.3. 删除 &lt;none&gt; 镜像</a></span></dt></dl></dd></dl></div>
	
	<p>
		<a class="ulink" href="https://www.docker.com" target="_top">https://www.docker.com</a>
	</p>
	


<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="install"></a>1.1. Installation</h2></div></div></div>
	
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm108453210880"></a>1.1.1. CentOS 8 Stream</h3></div></div></div>
		
		<p>安装 Docker</p>
		<pre class="screen">
		
[root@localhost ~]# dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo
Adding repo from: https://download.docker.com/linux/centos/docker-ce.repo

[root@localhost ~]# dnf install -y docker-ce

[root@localhost ~]# systemctl enable docker
[root@localhost ~]# systemctl start docker
		
		</pre>
		<p></p>
		<pre class="screen">
		
[root@localhost ~]# docker -v
Docker version 19.03.12, build 48a66213fe
		
		</pre>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm108453208304"></a>1.1.1.1. docker-compose</h4></div></div></div>
			
			<p>https://docs.docker.com/compose/install/</p>
			<pre class="screen">
			
curl -sL "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
docker-compose -v
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm108453206368"></a>1.1.1.2. 切换镜像</h4></div></div></div>
			
			<pre class="screen">
			
[root@netkiller ~]# cat &lt;&lt; EOF &gt; /etc/docker/daemon.json
&gt; 
&gt; {
&gt;   "registry-mirrors": [
&gt;     "https://hub-mirror.c.163.com",
&gt;     "https://mirror.baidubce.com",
&gt;     "https://docker.mirrors.ustc.edu.cn/"
&gt;   ]
&gt; }
&gt; 
&gt; EOF

[root@netkiller ~]# cat /etc/docker/daemon.json 

{
  "registry-mirrors": [
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com",
    "https://docker.mirrors.ustc.edu.cn/"
  ]
}

[root@netkiller ~]# systemctl restart docker

[root@netkiller ~]# docker info
Client:
 Context:    default
 Debug Mode: false
 Plugins:
  app: Docker App (Docker Inc., v0.9.1-beta3)
  buildx: Build with BuildKit (Docker Inc., v0.5.1-docker)
  scan: Docker Scan (Docker Inc., v0.8.0)

Server:
 Containers: 0
  Running: 0
  Paused: 0
  Stopped: 0
 Images: 0
 Server Version: 20.10.7
 Storage Driver: overlay2
  Backing Filesystem: xfs
  Supports d_type: true
  Native Overlay Diff: true
  userxattr: false
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Cgroup Version: 1
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
 Swarm: inactive
 Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: e25210fe30a0a703442421b0f60afac609f950a3
 runc version: v1.0.1-0-g4144b63
 init version: de40ad0
 Security Options:
  seccomp
   Profile: default
 Kernel Version: 4.18.0-326.el8.x86_64
 Operating System: CentOS Stream 8
 OSType: linux
 Architecture: x86_64
 CPUs: 4
 Total Memory: 7.514GiB
 Name: netkiller
 ID: 5GBU:CMWS:VIVP:TREZ:Y5AP:OGOW:EABK:NP4R:AWUA:S4J2:2YQ2:U7MT
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: false
 Insecure Registries:
  127.0.0.0/8
 Registry Mirrors:
  https://hub-mirror.c.163.com/
  https://mirror.baidubce.com/
  https://docker.mirrors.ustc.edu.cn/
 Live Restore Enabled: false			
			
			</pre>
		</div>
	</div>

	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm108453205136"></a>1.1.2. CentOS 7 docker-ce</h3></div></div></div>
		
		<p>
			下载 containerd.io
			<a class="ulink" href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages/" target="_top">https://download.docker.com/linux/centos/7/x86_64/stable/Packages/</a>
		</p>
		<pre class="screen">
		
[root@localhost ~]# yum install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.13-3.2.el7.x86_64.rpm
		
		</pre>
		<p>从官方网站获得最新社区版</p>
		<pre class="screen">
			
yum install -y yum-utils
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum makecache fast
yum -y install docker-ce

systemctl start docker
			
		</pre>
		<p>测试安装是否成功</p>
		<pre class="screen">
			
docker run hello-world
			
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm108453200880"></a>1.1.3. CentOS 6</h3></div></div></div>
		
		<pre class="screen">
			
yum install docker-io
service docker start
chkconfig docker on
docker pull centos:latest
docker images centos
			
		</pre>
		<p>test</p>
		<pre class="screen">
			
docker run -i -t centos /bin/bash
			
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm108453198592"></a>1.1.4. Ubuntu</h3></div></div></div>
		
		<p>Ubuntu 默认版本</p>
		<pre class="screen">
			
$ sudo apt update
$ sudo apt install docker.io
$ sudo ln -sf /usr/bin/docker.io /usr/local/bin/docker
$ sudo sed -i '$acomplete -F _docker docker' /etc/bash_completion.d/docker.io
			
		</pre>
		<pre class="screen">
			
$ sudo docker run -i -t ubuntu /bin/bash
			
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm108453196288"></a>1.1.5. Ubuntu docker-ce</h3></div></div></div>
		
		<p>从官方网站获得最新社区版</p>
		<pre class="screen">
		
#!/bin/bash

sudo apt remove docker docker-engine

sudo apt install \
    apt-transport-https \
    ca-certificates \
    curl \
    software-properties-common
	
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
sudo apt-key fingerprint 0EBFCD88

sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"
   
sudo apt update
sudo apt install docker-ce

apt-cache madison docker-ce
		
		</pre>
		<p>启动参数配置 /etc/default/docker</p>
		<pre class="screen">
		
neo@ubuntu:~$ cat /etc/default/docker
# Docker Upstart and SysVinit configuration file

#
# THIS FILE DOES NOT APPLY TO SYSTEMD
#
#   Please see the documentation for "systemd drop-ins":
#   https://docs.docker.com/engine/admin/systemd/
#

# Customize location of Docker binary (especially for development testing).
#DOCKERD="/usr/local/bin/dockerd"

# Use DOCKER_OPTS to modify the daemon startup options.
#DOCKER_OPTS="--dns 8.8.8.8 --dns 8.8.4.4"

# If you need Docker to use an HTTP proxy, it can also be specified here.
#export http_proxy="http://127.0.0.1:3128/"

# This is also a handy place to tweak where Docker's temporary files go.
#export DOCKER_TMPDIR="/mnt/bigdrive/docker-tmp"

		
		</pre>
		<p>启动脚本 /etc/init/docker.conf</p>
		<pre class="screen">
		
neo@ubuntu:~$ sudo cat /etc/init/docker.conf
[sudo] password for neo: 
description "Docker daemon"

start on (filesystem and net-device-up IFACE!=lo)
stop on runlevel [!2345]

limit nofile 524288 1048576

# Having non-zero limits causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
limit nproc unlimited unlimited

respawn

kill timeout 20

pre-start script
	# see also https://github.com/tianon/cgroupfs-mount/blob/master/cgroupfs-mount
	if grep -v '^#' /etc/fstab | grep -q cgroup \
		|| [ ! -e /proc/cgroups ] \
		|| [ ! -d /sys/fs/cgroup ]; then
		exit 0
	fi
	if ! mountpoint -q /sys/fs/cgroup; then
		mount -t tmpfs -o uid=0,gid=0,mode=0755 cgroup /sys/fs/cgroup
	fi
	(
		cd /sys/fs/cgroup
		for sys in $(awk '!/^#/ { if ($4 == 1) print $1 }' /proc/cgroups); do
			mkdir -p $sys
			if ! mountpoint -q $sys; then
				if ! mount -n -t cgroup -o $sys cgroup $sys; then
					rmdir $sys || true
				fi
			fi
		done
	)
end script

script
	# modify these in /etc/default/$UPSTART_JOB (/etc/default/docker)
	DOCKERD=/usr/bin/dockerd
	DOCKER_OPTS=
	if [ -f /etc/default/$UPSTART_JOB ]; then
		. /etc/default/$UPSTART_JOB
	fi
	exec "$DOCKERD" $DOCKER_OPTS --raw-logs
end script

# Don't emit "started" event until docker.sock is ready.
# See https://github.com/docker/docker/issues/6647
post-start script
	DOCKER_OPTS=
	DOCKER_SOCKET=
	if [ -f /etc/default/$UPSTART_JOB ]; then
		. /etc/default/$UPSTART_JOB
	fi

	if ! printf "%s" "$DOCKER_OPTS" | grep -qE -e '-H|--host'; then
		DOCKER_SOCKET=/var/run/docker.sock
	else
		DOCKER_SOCKET=$(printf "%s" "$DOCKER_OPTS" | grep -oP -e '(-H|--host)\W*unix://\K(\S+)' | sed 1q)
	fi

	if [ -n "$DOCKER_SOCKET" ]; then
		while ! [ -e "$DOCKER_SOCKET" ]; do
			initctl status $UPSTART_JOB | grep -qE "(stop|respawn)/" &amp;&amp; exit 1
			echo "Waiting for $DOCKER_SOCKET"
			sleep 0.1
		done
		echo "$DOCKER_SOCKET is up"
	fi
end script
		
		
		</pre>

	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm108453191664"></a>1.1.6. 测试 Docker</h3></div></div></div>
		
		<pre class="screen">
		
neo@MacBook-Pro ~ % docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
1b930d010525: Pull complete 
Digest: sha256:2557e3c07ed1e38f26e389462d03ed943586f744621577a99efb77324b0fe535
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/

neo@MacBook-Pro ~ % docker image ls 
REPOSITORY                                 TAG                 IMAGE ID            CREATED             SIZE
hello-world                                latest              fce289e99eb9        2 months ago        1.84kB

neo@MacBook-Pro ~ % docker container ls --all
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS                          PORTS               NAMES
ea694b443e9e        hello-world         "/hello"            About a minute ago   Exited (0) About a minute ago                       dreamy_feistel
		
		</pre>
	</div>

	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="docker.reset"></a>1.1.7. 重置 Docker</h3></div></div></div>
		
		<pre class="screen">
		
docker stop $(docker ps -a -q)
docker rm -f $(docker ps -a -q)
docker rmi -f $(docker images -q)
docker volume rm $(docker volume ls -q)	
		
		</pre>
	</div>

</div>


	

	

	

	

	

	


	

	



	

	


	

	

</div><div xmlns="" id="SOHUCS"></div><script xmlns="" charset="utf-8" type="text/javascript" src="https://cy-cdn.kuaizhan.com/upload/changyan.js"></script><script xmlns="" type="text/javascript">
window.changyan.api.config({
appid: 'cyvwjQUG3',
conf: 'prod_ef966242df3d8b5acb1e0ee9fc01cafe'
});
</script><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../contacts.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch01s02.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">1.5. 联系方式 </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 1.2. Docker 图形化管理界面</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script></body></html>